import pandas as pd

def test(sheetname):
    return f"{sheetname}_Test"  # Change if needed

def process_excel_easy(file_path, sheet_column_map, output_sheet="FinalOutput"):
    all_rows = []

    for sheet, columns in sheet_column_map.items():
        try:
            df = pd.read_excel(file_path, sheet_name=sheet)
        except:
            print(f"Sheet {sheet} not found")
            continue

        testname_value = test(sheet)

        if "TestName" not in df.columns:
            print(f"'TestName' missing in {sheet}")
            continue

        match = df[df["TestName"] == testname_value]
        if match.empty:
            print(f"No match in {sheet} for {testname_value}")
            continue

        row = match.iloc[0]
        data = {col: row.get(col, "") for col in columns}
        data["Sheet"] = sheet
        all_rows.append(data)

    if all_rows:
        pd.DataFrame(all_rows).to_excel(
            file_path,
            sheet_name=output_sheet,
            engine="openpyxl",
            index=False,
            mode="a",
            if_sheet_exists="replace"
        )
        print(f"✅ Data saved to sheet '{output_sheet}'")
    else:
        print("❌ No data found.")