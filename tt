import io.github.bonigarcia.wdm.WebDriverManager;
import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.edge.EdgeDriver;

import java.util.ArrayList;

public class ReadFileFromNewTab {

    public static void main(String[] args) {
        WebDriverManager.edgedriver().setup();
        WebDriver driver = new EdgeDriver();

        try {
            // Step 1: Log in to SharePoint and navigate to the file link
            driver.get("https://your-sharepoint-site-url");
            Thread.sleep(5000); // Adjust for login

            // Locate and click the file link that opens in a new tab
            WebElement fileLink = driver.findElement(By.xpath("//a[contains(text(), 'example.txt')]")); // Adjust locator
            fileLink.click();
            Thread.sleep(3000); // Wait for the new tab to open

            // Step 2: Switch to the new tab
            ArrayList<String> tabs = new ArrayList<>(driver.getWindowHandles());
            driver.switchTo().window(tabs.get(1)); // Switch to the second tab

            // Step 3: Extract content from the file displayed in the new tab
            // Option 1: Use JavaScript to get the body text
            JavascriptExecutor js = (JavascriptExecutor) driver;
            String content = (String) js.executeScript("return document.body.innerText;");
            System.out.println("File Content:\n" + content);

            // Optional: Save the content to a local file
            String localFilePath = System.getProperty("user.home") + "/Downloads/copied_file_from_new_tab.txt";
            try (java.io.FileWriter writer = new java.io.FileWriter(localFilePath)) {
                writer.write(content);
            }
            System.out.println("Content saved to: " + localFilePath);

            // Step 4: Close the new tab and switch back to the original tab
            driver.close();
            driver.switchTo().window(tabs.get(0));

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            driver.quit();
        }
    }
}