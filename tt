import pandas as pd

def compare_xls(src_file, dest_file, output_file):
    # Read source (assume first sheet)
    src_df = pd.read_excel(src_file, sheet_name=0)

    # Read all destination sheets into a dict
    dest_xls = pd.ExcelFile(dest_file)
    dest_dfs = {sheet: pd.read_excel(dest_file, sheet_name=sheet) for sheet in dest_xls.sheet_names}

    results = []

    # Loop through each column in source
    for col in src_df.columns:
        for sheet, dest_df in dest_dfs.items():
            if col in dest_df.columns:
                # We found a common column
                for idx, src_val in enumerate(src_df[col]):
                    # Check if src_val exists in destination column
                    match_rows = dest_df[dest_df[col] == src_val]

                    if not match_rows.empty:
                        for _, dest_row in match_rows.iterrows():
                            # Compare entire row
                            for compare_col in src_df.columns:
                                src_value = src_df.iloc[idx][compare_col] if compare_col in src_df.columns else "N/A"
                                dest_value = dest_row[compare_col] if compare_col in dest_df.columns else "N/A"
                                status = "PASS" if src_value == dest_value else "FAIL"

                                results.append({
                                    "Key Column": col,
                                    "Key Value": src_val,
                                    "Row": idx + 1,
                                    "Column": compare_col,
                                    "Source Value": src_value,
                                    "Destination Value": dest_value,
                                    "Status": status,
                                    "Sheet": sheet
                                })
                    else:
                        results.append({
                            "Key Column": col,
                            "Key Value": src_val,
                            "Row": idx + 1,
                            "Column": col,
                            "Source Value": src_val,
                            "Destination Value": "Not Found",
                            "Status": "FAIL",
                            "Sheet": sheet
                        })

    # Save results
    result_df = pd.DataFrame(results)
    result_df.to_excel(output_file, index=False)

    print(f"Comparison completed. Results saved to {output_file}")


# Example usage
src_file = "source.xls"
dest_file = "destination.xls"
output_file = "comparison_result.xlsx"

compare_xls(src_file, dest_file, output_file)