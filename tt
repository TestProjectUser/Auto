import io.github.bonigarcia.wdm.WebDriverManager;
import org.openqa.selenium.By;
import org.openqa.selenium.edge.EdgeDriver;
import org.openqa.selenium.edge.EdgeOptions;
import org.openqa.selenium.devtools.DevTools;
import org.openqa.selenium.devtools.v114.network.Network;
import org.openqa.selenium.devtools.v114.network.model.Response;
import org.openqa.selenium.WebDriver;

public class EdgeCDPExample {

    public static void main(String[] args) {
        // Setup WebDriver for Edge
        WebDriverManager.edgedriver().setup();

        // Set up Edge options
        EdgeOptions options = new EdgeOptions();
        WebDriver driver = new EdgeDriver(options);

        try {
            // Enable network interception using DevTools Protocol
            DevTools devTools = ((EdgeDriver) driver).getDevTools();
            devTools.createSession();
            devTools.send(Network.enable());
            devTools.addListener(Network.responseReceived(), response -> {
                // Check if the response is the file download
                if (response.getResponse().getUrl().contains("your-file-name.extension")) {
                    System.out.println("Intercepted file URL: " + response.getResponse().getUrl());
                    // You can then proceed to download or log the URL
                }
            });

            // Navigate to the SharePoint site
            driver.get("https://your-sharepoint-site-url");

            // Trigger file download (make sure to adjust this part based on how the download is triggered)
            driver.findElement(By.xpath("//a[contains(text(), 'your-file-name')]")).click();

            // Wait for the download to complete
            Thread.sleep(5000);

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            driver.quit();
        }
    }
}