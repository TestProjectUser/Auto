const fs = require('fs');
const json2csv = require('json2csv').parse;

// Read Newman output
const rawData = fs.readFileSync('output.json');
const newmanResults = JSON.parse(rawData);

// Extract data from responses
const records = newmanResults.run.executions.map(exec => ({
    id: exec.item.name,  
    request: JSON.stringify(exec.request.body),
    response: exec.response ? exec.response.stream.toString() : 'No Response'
}));

// Convert to CSV format
const csv = json2csv(records);
fs.writeFileSync('final_output.csv', csv);

console.log('CSV file generated: final_output.csv');