// Get API response as JSON
let responseJson = pm.response.json();

// Convert response to string
let responseData = JSON.stringify(responseJson);

// Get current iteration ID
let recordId = pm.iterationData.get("id");

// Get existing responses from globals
let storedResponses = pm.globals.get("allResponses");

// If no previous responses, initialize an empty array
if (!storedResponses) {
    storedResponses = [];
} else {
    storedResponses = JSON.parse(storedResponses);
}

// Append the new response
storedResponses.push({ id: recordId, response: responseData });

// Store the updated responses back in globals
pm.globals.set("allResponses", JSON.stringify(storedResponses));