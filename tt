import io.github.bonigarcia.wdm.WebDriverManager;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.edge.EdgeDriver;
import org.openqa.selenium.edge.EdgeOptions;

import java.io.*;
import java.nio.file.Paths;
import java.util.Map;

public class SharePointFileProcessor {

    public static void main(String[] args) {
        // Set up WebDriver for Edge
        WebDriverManager.edgedriver().setup();

        // Specify the download directory
        String downloadDir = Paths.get(System.getProperty("user.home"), "Downloads", "SharePointFiles").toString();

        // Configure EdgeOptions
        EdgeOptions options = new EdgeOptions();
        options.setExperimentalOption("prefs", Map.of(
            "download.default_directory", downloadDir,
            "download.prompt_for_download", false,
            "safebrowsing.enabled", true
        ));

        WebDriver driver = new EdgeDriver(options);

        try {
            // Navigate to SharePoint and log in
            driver.get("https://your-sharepoint-site-url");
            Thread.sleep(5000); // Adjust based on your login process

            // Click the file link to download (adjust locator as needed)
            WebElement fileLink = driver.findElement(By.xpath("//a[contains(text(), 'example.txt')]"));
            fileLink.click();

            // Wait for download to complete
            Thread.sleep(10000);

            // Read the downloaded file
            File downloadedFile = new File(downloadDir + "/example.txt");
            if (downloadedFile.exists()) {
                BufferedReader reader = new BufferedReader(new FileReader(downloadedFile));
                StringBuilder content = new StringBuilder();
                String line;
                while ((line = reader.readLine()) != null) {
                    content.append(line).append("\n");
                }
                reader.close();

                // Modify the content (optional)
                String newContent = content.toString().toUpperCase(); // Example: Convert to uppercase

                // Save the modified content to a new file
                File newFile = new File(downloadDir + "/modified_example.txt");
                BufferedWriter writer = new BufferedWriter(new FileWriter(newFile));
                writer.write(newContent);
                writer.close();

                System.out.println("Modified file saved to: " + newFile.getAbsolutePath());
            } else {
                System.out.println("Downloaded file not found.");
            }

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            driver.quit();
        }
    }
}